<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UTC Hack ‚Äî Time Converter</title>

  <!-- PWA Meta Tags -->
  <meta name="application-name" content="UTC Hack">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="UTC Hack">
  <meta name="theme-color" content="#c45c3e">

  <!-- Icons -->
  <link rel="icon" type="image/svg+xml" href="/icon.svg">
  <link rel="apple-touch-icon" href="/icon-180.png">
  <link rel="manifest" href="/manifest.json">
  <style>
    :root {
      /* Frank Lloyd Wright Prairie Style - Light Theme */
      --bg-primary: #f5f0e6;
      --bg-secondary: #ebe4d4;
      --bg-card: #fff8ee;
      --text-primary: #2c2416;
      --text-secondary: #5c4d3a;
      --text-muted: #8b7d6b;
      --accent-terracotta: #c45c3e;
      --accent-gold: #c9a227;
      --accent-sage: #7a8b6e;
      --accent-brown: #6b4423;
      --border-color: #d4c9b5;
      --border-strong: #b8a88a;
      --shadow: rgba(44, 36, 22, 0.1);
      --geometric-line: #c45c3e;
      --leadwork: rgba(107, 68, 35, 0.35);
    }

    [data-theme="dark"] {
      --bg-primary: #1a1612;
      --bg-secondary: #2a241c;
      --bg-card: #322a20;
      --text-primary: #f0e8d8;
      --text-secondary: #c9bda8;
      --text-muted: #8b7d6b;
      --accent-terracotta: #e07050;
      --accent-gold: #ddb84a;
      --accent-sage: #9aab8e;
      --accent-brown: #a67c52;
      --border-color: #4a4035;
      --border-strong: #6b5d4a;
      --shadow: rgba(0, 0, 0, 0.3);
      --geometric-line: #e07050;
      --leadwork: rgba(180, 160, 130, 0.5);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
      transition: background-color 0.3s, color 0.3s;
    }

    /* FLW Geometric Header Band - subtle */
    .header-band {
      background: var(--accent-brown);
      height: 3px;
      position: relative;
    }

    .header-band::after {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: var(--accent-gold);
    }

    .container {
      max-width: 720px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
      position: relative;
    }

    /* Subtle FLW-inspired vertical leadwork borders */
    .container::before,
    .container::after {
      content: '';
      position: fixed;
      top: 0;
      bottom: 0;
      width: 20px;
      pointer-events: none;
      opacity: 0.7;
      background:
        /* Thin vertical lines */
        linear-gradient(90deg,
          transparent 0px,
          transparent 8px,
          var(--leadwork) 8px,
          var(--leadwork) 9px,
          transparent 9px,
          transparent 11px,
          var(--leadwork) 11px,
          var(--leadwork) 12px,
          transparent 12px
        ),
        /* Small diamond accents */
        repeating-linear-gradient(180deg,
          transparent 0px,
          transparent 80px,
          var(--leadwork) 80px,
          transparent 84px,
          transparent 88px
        );
    }

    .container::before {
      left: 0;
    }

    .container::after {
      right: 0;
      transform: scaleX(-1);
    }

    @media (max-width: 800px) {
      .container::before,
      .container::after {
        display: none;
      }
    }

    /* Header with horizontal emphasis */
    header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
    }

    header::after {
      content: '';
      display: block;
      width: 200px;
      height: 3px;
      background: var(--accent-terracotta);
      margin: 1rem auto 0;
    }

    h1 {
      font-size: 1.8rem;
      font-weight: 400;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-primary);
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-top: 0.5rem;
      letter-spacing: 0.05em;
    }

    /* Theme Toggle - FLW style */
    .theme-toggle {
      background: transparent;
      border: 1px solid var(--border-color);
      padding: 0.5rem 1.25rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      transition: all 0.2s;
      position: relative;
    }

    .theme-toggle::before,
    .theme-toggle::after {
      content: '';
      position: absolute;
      width: 8px;
      height: 8px;
      border: 1px solid var(--accent-gold);
      opacity: 0.6;
    }

    .theme-toggle::before {
      top: -1px;
      left: -1px;
      border-right: none;
      border-bottom: none;
    }

    .theme-toggle::after {
      bottom: -1px;
      right: -1px;
      border-left: none;
      border-top: none;
    }

    .theme-toggle:hover {
      border-color: var(--accent-gold);
      color: var(--text-secondary);
    }

    /* Live Clocks - Horizontal Strip */
    .clocks-strip {
      display: flex;
      justify-content: center;
      gap: 3rem;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 2rem;
      position: relative;
    }

    /* Subtle horizontal line accents */
    .clocks-strip::before,
    .clocks-strip::after {
      content: '';
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 1px;
      background: linear-gradient(90deg,
        transparent 0%,
        var(--leadwork) 20%,
        var(--leadwork) 80%,
        transparent 100%
      );
    }

    .clocks-strip::before {
      top: 4px;
    }

    .clocks-strip::after {
      bottom: 4px;
    }

    .clock-item {
      text-align: center;
    }

    .clock-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .clock-time {
      font-size: 1.5rem;
      font-weight: 300;
      font-family: 'SF Mono', 'Consolas', monospace;
      color: var(--accent-terracotta);
    }

    .clock-item.local .clock-time {
      color: var(--accent-sage);
    }

    /* Main Card */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-strong);
      padding: 2rem;
      position: relative;
    }

    /* FLW-style corner accents - like window leading */
    .card::before,
    .card::after {
      content: '';
      position: absolute;
      pointer-events: none;
    }

    .card::before {
      top: 10px;
      left: 10px;
      width: 45px;
      height: 45px;
      border-left: 2px solid var(--accent-gold);
      border-top: 2px solid var(--accent-gold);
      opacity: 0.7;
    }

    .card::after {
      bottom: 10px;
      right: 10px;
      width: 45px;
      height: 45px;
      border-right: 2px solid var(--accent-gold);
      border-bottom: 2px solid var(--accent-gold);
      opacity: 0.7;
    }

    /* Small squares at corner bracket ends */
    .card-corner-tl,
    .card-corner-br {
      position: absolute;
      width: 6px;
      height: 6px;
      background: var(--accent-gold);
      opacity: 0.7;
    }

    .card-corner-tl {
      top: 10px;
      left: 10px;
    }

    .card-corner-br {
      bottom: 10px;
      right: 10px;
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 400;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-secondary);
      text-align: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    /* Direction Toggle */
    .direction-toggle {
      display: flex;
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
      border-radius: 0;
    }

    .direction-btn {
      flex: 1;
      padding: 1rem;
      background: var(--bg-secondary);
      border: none;
      cursor: pointer;
      font-size: 0.85rem;
      color: var(--text-secondary);
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .direction-btn:first-child {
      border-right: 1px solid var(--border-color);
    }

    .direction-btn.active {
      background: var(--accent-terracotta);
      color: white;
    }

    .direction-btn:hover:not(.active) {
      background: var(--bg-primary);
    }

    /* Form Steps */
    .step {
      margin-bottom: 1.5rem;
    }

    .step-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .step-number {
      width: 28px;
      height: 28px;
      background: var(--accent-terracotta);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .step-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-secondary);
    }

    /* Input Styling */
    input[type="datetime-local"],
    input[type="text"] {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 1px solid var(--border-color);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    input:focus {
      outline: none;
      border-color: var(--accent-terracotta);
    }

    input::placeholder {
      color: var(--text-muted);
    }

    /* Location feedback */
    .location-feedback {
      margin-top: 0.5rem;
      font-size: 0.85rem;
      min-height: 1.5rem;
    }

    .location-feedback.success {
      color: var(--accent-sage);
    }

    .location-feedback.error {
      color: var(--accent-terracotta);
    }

    .location-feedback.loading {
      color: var(--text-muted);
    }

    /* Convert Button */
    .convert-btn {
      width: 100%;
      padding: 1rem;
      background: var(--accent-terracotta);
      color: white;
      border: none;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 1rem;
    }

    .convert-btn:hover {
      background: var(--accent-brown);
    }

    .convert-btn:disabled {
      background: var(--text-muted);
      cursor: not-allowed;
    }

    /* Result Display */
    .result {
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border-color);
      display: none;
      position: relative;
    }

    /* Subtle centered diamond at result divider */
    .result::before {
      content: '';
      position: absolute;
      top: -4px;
      left: 50%;
      transform: translateX(-50%) rotate(45deg);
      width: 6px;
      height: 6px;
      background: var(--bg-card);
      border-top: 1px solid var(--border-color);
      border-left: 1px solid var(--border-color);
    }

    .result.visible {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 1rem 0;
      border-bottom: 1px solid var(--border-color);
    }

    .result-row:last-child {
      border-bottom: none;
    }

    .result-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
    }

    .result-value {
      font-size: 1.1rem;
      color: var(--text-primary);
      text-align: right;
    }

    .result-value.highlight {
      color: var(--accent-terracotta);
      font-size: 1.25rem;
    }

    .dst-indicator {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-left: 0.5rem;
      border-radius: 2px;
    }

    .dst-indicator.active {
      background: var(--accent-gold);
      color: var(--bg-primary);
    }

    .dst-indicator.inactive {
      background: var(--accent-sage);
      color: white;
    }

    /* Footer */
    footer {
      text-align: center;
      margin-top: 2rem;
      padding-top: 1.5rem;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 1px;
      background: linear-gradient(90deg,
        transparent 0%,
        var(--border-color) 30%,
        var(--border-color) 70%,
        transparent 100%
      );
    }

    .detected-tz {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Responsive - iPhone optimized, fills viewport */
    @media (max-width: 600px) {
      .container {
        padding: 1rem;
      }

      header {
        margin-bottom: 0.75rem;
      }

      header::after {
        margin: 0.5rem auto 0;
        width: 120px;
      }

      h1 {
        font-size: 1.3rem;
      }

      .subtitle {
        display: none;
      }

      .clocks-strip {
        flex-direction: column;
        gap: 0;
        padding: 0.75rem 0;
        margin-bottom: 1rem;
        background: transparent;
        border: none;
      }

      .clocks-strip::before,
      .clocks-strip::after {
        display: none;
      }

      .clock-item {
        padding: 0.5rem 0;
      }

      .clock-label {
        font-size: 0.65rem;
        margin-bottom: 0.25rem;
      }

      .clock-time {
        font-size: 1.8rem;
      }

      .card {
        padding: 1.25rem;
      }

      /* Simple corner brackets for mobile */
      .card::before {
        top: 8px;
        left: 8px;
        width: 20px;
        height: 20px;
        border-width: 1px;
      }

      .card::after {
        bottom: 8px;
        right: 8px;
        width: 20px;
        height: 20px;
        border-width: 1px;
      }

      .card-corner-tl,
      .card-corner-br {
        display: none;
      }

      .direction-toggle {
        margin-bottom: 1rem;
      }

      .direction-btn {
        padding: 0.75rem;
        font-size: 0.75rem;
      }

      .step {
        margin-bottom: 0.75rem;
      }

      .step-header {
        margin-bottom: 0.5rem;
        gap: 0.5rem;
      }

      .step-number {
        width: 24px;
        height: 24px;
        font-size: 0.75rem;
      }

      .step-label {
        font-size: 0.7rem;
      }

      input[type="datetime-local"],
      input[type="text"] {
        padding: 0.75rem;
        font-size: 0.95rem;
        text-align: center;
        max-width: 100%;
      }

      .location-feedback {
        min-height: 1.2rem;
        font-size: 0.75rem;
        margin-top: 0.3rem;
        text-align: center;
      }

      .convert-btn {
        margin-top: 0.5rem;
        padding: 0.875rem;
        font-size: 0.95rem;
      }

      .result {
        margin-top: 1rem;
        padding-top: 1rem;
      }

      .result-row {
        padding: 0.6rem 0;
      }

      .result-label {
        font-size: 0.65rem;
      }

      .result-value {
        font-size: 0.9rem;
      }

      .result-value.highlight {
        font-size: 1rem;
      }

      footer {
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        gap: 0.5rem;
        flex-shrink: 0;
      }

      .detected-tz {
        font-size: 0.7rem;
      }

      .theme-toggle {
        padding: 0.4rem 0.75rem;
        font-size: 0.65rem;
      }
    }
  </style>
</head>
<body>
  <div class="header-band"></div>

  <div class="container">
    <header>
      <h1>UTC Hack</h1>
    </header>

    <div class="clocks-strip">
      <div class="clock-item">
        <div class="clock-label">UTC</div>
        <div class="clock-time" id="utc-clock">--:--:--</div>
      </div>
      <div class="clock-item local">
        <div class="clock-label">Local</div>
        <div class="clock-time" id="local-clock">--:--:--</div>
      </div>
    </div>

    <div class="card">
      <div class="card-corner-tl"></div>
      <div class="card-corner-br"></div>
      <h2 class="card-title">Time Converter</h2>
      <div class="direction-toggle">
        <button class="direction-btn active" data-direction="toLocal" onclick="setDirection('toLocal')">
          UTC ‚Üí Local Time
        </button>
        <button class="direction-btn" data-direction="toUTC" onclick="setDirection('toUTC')">
          Local Time ‚Üí UTC
        </button>
      </div>

      <div class="step">
        <div class="step-header">
          <span class="step-number">1</span>
          <span class="step-label" id="time-step-label">Enter UTC Date & Time</span>
        </div>
        <input type="datetime-local" id="time-input">
      </div>

      <div class="step">
        <div class="step-header">
          <span class="step-number">2</span>
          <span class="step-label">Enter Location (any city or town)</span>
        </div>
        <input type="text" id="location-input" placeholder="e.g., Lincoln, Montana or Missoula, MT">
        <div class="location-feedback" id="location-feedback"></div>
      </div>

      <button class="convert-btn" id="convert-btn" onclick="convert()">Convert</button>

      <div class="result" id="result">
        <div class="result-row">
          <div class="result-label">Location</div>
          <div class="result-value" id="result-location">‚Äî</div>
        </div>
        <div class="result-row">
          <div class="result-label">Timezone</div>
          <div class="result-value" id="result-timezone">‚Äî</div>
        </div>
        <div class="result-row">
          <div class="result-label" id="result-utc-label">UTC Time</div>
          <div class="result-value" id="result-utc">‚Äî</div>
        </div>
        <div class="result-row">
          <div class="result-label" id="result-local-label">Local Time</div>
          <div class="result-value highlight" id="result-local">‚Äî</div>
        </div>
      </div>
    </div>

    <footer>
      <p class="detected-tz">Your detected timezone: <span id="user-tz"></span></p>
      <button class="theme-toggle" onclick="toggleTheme()">
        <span id="theme-icon">‚òÄÔ∏è</span>
        <span id="theme-label">Light</span>
      </button>
    </footer>
  </div>

  <script>
    // State
    let currentDirection = 'toLocal';
    let resolvedTimezone = null;
    let resolvedDisplayName = null;
    const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('user-tz').textContent = userTimezone;
      updateClocks();
      setInterval(updateClocks, 1000);
      setDefaultTime();

      // Load saved theme
      const savedTheme = localStorage.getItem('theme') || 'light';
      setTheme(savedTheme);

      // Location input with debounce
      document.getElementById('location-input').addEventListener('input', debounce(lookupLocation, 400));
    });

    function updateClocks() {
      const now = new Date();
      document.getElementById('utc-clock').textContent = now.toLocaleTimeString('en-US', {
        timeZone: 'UTC', hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
      document.getElementById('local-clock').textContent = now.toLocaleTimeString('en-US', {
        hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
    }

    function setDefaultTime() {
      const now = new Date();
      document.getElementById('time-input').value = now.toISOString().slice(0, 16);
    }

    function setDirection(dir) {
      currentDirection = dir;
      document.querySelectorAll('.direction-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.direction === dir);
      });

      // Update labels
      const timeLabel = document.getElementById('time-step-label');
      const resultUtcLabel = document.getElementById('result-utc-label');
      const resultLocalLabel = document.getElementById('result-local-label');

      if (dir === 'toLocal') {
        timeLabel.textContent = 'Enter UTC Date & Time';
        resultUtcLabel.textContent = 'UTC Time (input)';
        resultLocalLabel.textContent = 'Local Time (result)';
      } else {
        timeLabel.textContent = 'Enter Local Date & Time';
        resultUtcLabel.textContent = 'UTC Time (result)';
        resultLocalLabel.textContent = 'Local Time (input)';
      }

      // Clear previous result
      document.getElementById('result').classList.remove('visible');
    }

    async function lookupLocation() {
      const input = document.getElementById('location-input').value.trim();
      const feedback = document.getElementById('location-feedback');

      if (!input) {
        feedback.textContent = '';
        feedback.className = 'location-feedback';
        resolvedTimezone = null;
        return;
      }

      feedback.textContent = 'Looking up...';
      feedback.className = 'location-feedback loading';

      try {
        const res = await fetch(`/api/location?q=${encodeURIComponent(input)}`);
        const data = await res.json();

        if (data.timezone) {
          resolvedTimezone = data.timezone;
          resolvedDisplayName = data.displayName;
          feedback.textContent = `‚úì ${data.timezone} (${data.tzAbbreviation})`;
          feedback.className = 'location-feedback success';
        } else {
          resolvedTimezone = null;
          feedback.textContent = data.error || 'Location not found';
          feedback.className = 'location-feedback error';
        }
      } catch (e) {
        resolvedTimezone = null;
        feedback.textContent = 'Lookup failed ‚Äî try again';
        feedback.className = 'location-feedback error';
      }
    }

    async function convert() {
      const timeInput = document.getElementById('time-input').value;

      if (!timeInput) {
        alert('Please enter a date and time');
        return;
      }

      if (!resolvedTimezone) {
        alert('Please enter a valid location');
        return;
      }

      try {
        const res = await fetch('/api/convert', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            time: timeInput,
            timezone: resolvedTimezone,
            direction: currentDirection
          })
        });

        const data = await res.json();

        if (data.error) {
          alert(data.error);
          return;
        }

        // Populate results
        document.getElementById('result-location').textContent = shortenDisplayName(resolvedDisplayName);

        let tzDisplay = `${data.timezone} (${data.tzAbbreviation})`;
        if (data.isDST) {
          tzDisplay += '<span class="dst-indicator active">DST</span>';
        } else if (resolvedTimezone === 'America/Phoenix') {
          tzDisplay += '<span class="dst-indicator inactive">No DST</span>';
        }
        document.getElementById('result-timezone').innerHTML = tzDisplay;

        document.getElementById('result-utc').textContent = data.utcFormatted;
        document.getElementById('result-local').textContent = data.localFormatted;

        // Highlight the result based on direction
        const utcEl = document.getElementById('result-utc');
        const localEl = document.getElementById('result-local');

        if (currentDirection === 'toLocal') {
          utcEl.classList.remove('highlight');
          localEl.classList.add('highlight');
        } else {
          localEl.classList.remove('highlight');
          utcEl.classList.add('highlight');
        }

        document.getElementById('result').classList.add('visible');
      } catch (e) {
        alert('Conversion failed');
      }
    }

    function shortenDisplayName(name) {
      if (!name) return '‚Äî';
      // Take first two parts (city, state/country)
      const parts = name.split(', ');
      return parts.slice(0, 2).join(', ');
    }

    function toggleTheme() {
      const html = document.documentElement;
      const current = html.getAttribute('data-theme');
      const next = current === 'light' ? 'dark' : 'light';
      setTheme(next);
      localStorage.setItem('theme', next);
    }

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      document.getElementById('theme-icon').textContent = theme === 'light' ? '‚òÄÔ∏è' : 'üåô';
      document.getElementById('theme-label').textContent = theme === 'light' ? 'Light' : 'Dark';
    }

    function debounce(func, wait) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(() => {});
    }

    // Pull to refresh
    let touchStartY = 0;
    let isPulling = false;

    function getScrollTop() {
      return window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    }

    document.addEventListener('touchstart', (e) => {
      if (getScrollTop() <= 0) {
        touchStartY = e.touches[0].clientY;
        isPulling = true;
      }
    }, { passive: true });

    document.addEventListener('touchmove', (e) => {
      if (!isPulling) return;
      const touchY = e.touches[0].clientY;
      const pullDistance = touchY - touchStartY;
      if (pullDistance > 80 && getScrollTop() <= 0) {
        isPulling = false;
        location.reload();
      }
    }, { passive: true });

    document.addEventListener('touchend', () => {
      isPulling = false;
    });
  </script>
</body>
</html>
