<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UTC Hack â€” Zulu Time Converter for Pilots & Aviation</title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="Free UTC/Zulu time converter for pilots and aviation professionals. Convert between Zulu time and local time for any city. Perfect for flight planning, METAR/TAF interpretation, and international operations.">
  <meta name="keywords" content="UTC, Zulu time, pilot, aviation, flight planning, timezone converter, GMT, METAR, TAF, world clock, DST, ATC, international flights">
  <link rel="canonical" href="https://utchack.com/">

  <!-- Hreflang tags for international SEO -->
  <link rel="alternate" hreflang="en" href="https://utchack.com/">
  <link rel="alternate" hreflang="de" href="https://utchack.com/de/">
  <link rel="alternate" hreflang="fr" href="https://utchack.com/fr/">
  <link rel="alternate" hreflang="es" href="https://utchack.com/es/">
  <link rel="alternate" hreflang="pt" href="https://utchack.com/pt/">
  <link rel="alternate" hreflang="it" href="https://utchack.com/it/">
  <link rel="alternate" hreflang="pl" href="https://utchack.com/pl/">
  <link rel="alternate" hreflang="nl" href="https://utchack.com/nl/">
  <link rel="alternate" hreflang="ru" href="https://utchack.com/ru/">
  <link rel="alternate" hreflang="ja" href="https://utchack.com/ja/">
  <link rel="alternate" hreflang="zh" href="https://utchack.com/zh/">
  <link rel="alternate" hreflang="ko" href="https://utchack.com/ko/">
  <link rel="alternate" hreflang="ar" href="https://utchack.com/ar/">
  <link rel="alternate" hreflang="x-default" href="https://utchack.com/">

  <!-- Open Graph / Social Sharing -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://utchack.com/">
  <meta property="og:title" content="UTC Hack â€” Zulu Time Converter for Pilots">
  <meta property="og:description" content="Free UTC/Zulu time converter for pilots and aviation. Convert between Zulu and local time for any city worldwide.">
  <meta property="og:image" content="https://utchack.com/icon-512.png">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="UTC Hack â€” Zulu Time Converter for Pilots">
  <meta name="twitter:description" content="Free UTC/Zulu time converter for pilots and aviation.">

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "UTC Hack - Zulu Time Converter",
    "url": "https://utchack.com",
    "description": "Free UTC/Zulu time converter for pilots and aviation professionals. Convert between Zulu time and local time for flight planning, METAR interpretation, and international operations.",
    "applicationCategory": "UtilityApplication",
    "keywords": "Zulu time, UTC, pilot, aviation, flight planning, timezone",
    "audience": {
      "@type": "Audience",
      "audienceType": "Pilots, Aviation Professionals, Flight Dispatchers"
    },
    "operatingSystem": "Any",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    }
  }
  </script>

  <!-- PWA Meta Tags -->
  <meta name="application-name" content="UTC Hack">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="UTC Hack">
  <meta name="theme-color" content="#c45c3e">

  <!-- Icons -->
  <link rel="icon" type="image/svg+xml" href="/icon.svg">
  <link rel="apple-touch-icon" href="/icon-180.png">
  <link rel="manifest" href="/manifest.json">
  <style>
    :root {
      /* Frank Lloyd Wright Prairie Style - Light Theme */
      --bg-primary: #f5f0e6;
      --bg-secondary: #ebe4d4;
      --bg-card: #fff8ee;
      --text-primary: #2c2416;
      --text-secondary: #5c4d3a;
      --text-muted: #8b7d6b;
      --accent-terracotta: #c45c3e;
      --accent-gold: #c9a227;
      --accent-sage: #7a8b6e;
      --accent-brown: #6b4423;
      --border-color: #d4c9b5;
      --border-strong: #b8a88a;
      --shadow: rgba(44, 36, 22, 0.1);
      --geometric-line: #c45c3e;
      --leadwork: rgba(107, 68, 35, 0.35);
      color-scheme: light;
    }

    [data-theme="dark"] {
      color-scheme: dark;
      --bg-primary: #1a1612;
      --bg-secondary: #2a241c;
      --bg-card: #322a20;
      --text-primary: #f0e8d8;
      --text-secondary: #c9bda8;
      --text-muted: #8b7d6b;
      --accent-terracotta: #e07050;
      --accent-gold: #ddb84a;
      --accent-sage: #9aab8e;
      --accent-brown: #a67c52;
      --border-color: #4a4035;
      --border-strong: #6b5d4a;
      --shadow: rgba(0, 0, 0, 0.3);
      --geometric-line: #e07050;
      --leadwork: rgba(180, 160, 130, 0.5);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
      transition: background-color 0.3s, color 0.3s;
    }

    /* FLW Geometric Header Band - subtle */
    .header-band {
      background: var(--accent-brown);
      height: 3px;
      position: relative;
    }

    .header-band::after {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: var(--accent-gold);
    }

    .container {
      max-width: 720px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
      position: relative;
    }

    /* Subtle FLW-inspired vertical leadwork borders */
    .container::before,
    .container::after {
      content: '';
      position: fixed;
      top: 0;
      bottom: 0;
      width: 20px;
      pointer-events: none;
      opacity: 0.7;
      background:
        /* Thin vertical lines */
        linear-gradient(90deg,
          transparent 0px,
          transparent 8px,
          var(--leadwork) 8px,
          var(--leadwork) 9px,
          transparent 9px,
          transparent 11px,
          var(--leadwork) 11px,
          var(--leadwork) 12px,
          transparent 12px
        ),
        /* Small diamond accents */
        repeating-linear-gradient(180deg,
          transparent 0px,
          transparent 80px,
          var(--leadwork) 80px,
          transparent 84px,
          transparent 88px
        );
    }

    .container::before {
      left: 0;
    }

    .container::after {
      right: 0;
      transform: scaleX(-1);
    }

    @media (max-width: 800px) {
      .container::before,
      .container::after {
        display: none;
      }
    }

    /* Header with horizontal emphasis */
    header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
    }

    header::after {
      content: '';
      display: block;
      width: 200px;
      height: 3px;
      background: var(--accent-terracotta);
      margin: 1rem auto 0;
    }

    h1 {
      font-size: 1.8rem;
      font-weight: 400;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-primary);
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-top: 0.5rem;
      letter-spacing: 0.05em;
    }

    /* Footer Buttons - FLW style */
    .footer-btn {
      background: transparent;
      border: 1px solid var(--border-color);
      padding: 0.5rem 1.25rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      text-decoration: none;
      transition: all 0.2s;
      position: relative;
      width: 110px;
      font-family: inherit;
    }

    .footer-btn::before,
    .footer-btn::after {
      content: '';
      position: absolute;
      width: 8px;
      height: 8px;
      border: 1px solid var(--accent-gold);
      opacity: 0.6;
    }

    .footer-btn::before {
      top: -1px;
      left: -1px;
      border-right: none;
      border-bottom: none;
    }

    .footer-btn::after {
      bottom: -1px;
      right: -1px;
      border-left: none;
      border-top: none;
    }

    .footer-btn:hover {
      border-color: var(--accent-gold);
      color: var(--text-secondary);
    }

    /* Live Clocks - Horizontal Strip */
    .clocks-strip {
      display: flex;
      justify-content: center;
      gap: 3rem;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 2rem;
      position: relative;
    }

    /* Subtle horizontal line accents */
    .clocks-strip::before,
    .clocks-strip::after {
      content: '';
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 1px;
      background: linear-gradient(90deg,
        transparent 0%,
        var(--leadwork) 20%,
        var(--leadwork) 80%,
        transparent 100%
      );
    }

    .clocks-strip::before {
      top: 4px;
    }

    .clocks-strip::after {
      bottom: 4px;
    }

    .clock-item {
      text-align: center;
    }

    .clock-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .clock-time {
      font-size: 1.5rem;
      font-weight: 300;
      font-family: 'SF Mono', 'Consolas', monospace;
      color: var(--accent-terracotta);
    }

    .clock-item.local .clock-time {
      color: var(--accent-sage);
    }

    /* Main Card */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-strong);
      padding: 2rem;
      position: relative;
    }

    /* FLW-style corner accents - like window leading */
    .card::before,
    .card::after {
      content: '';
      position: absolute;
      pointer-events: none;
    }

    .card::before {
      top: 10px;
      left: 10px;
      width: 45px;
      height: 45px;
      border-left: 2px solid var(--accent-gold);
      border-top: 2px solid var(--accent-gold);
      opacity: 0.7;
    }

    .card::after {
      bottom: 10px;
      right: 10px;
      width: 45px;
      height: 45px;
      border-right: 2px solid var(--accent-gold);
      border-bottom: 2px solid var(--accent-gold);
      opacity: 0.7;
    }

    /* Small squares at corner bracket ends */
    .card-corner-tl,
    .card-corner-br {
      position: absolute;
      width: 6px;
      height: 6px;
      background: var(--accent-gold);
      opacity: 0.7;
    }

    .card-corner-tl {
      top: 10px;
      left: 10px;
    }

    .card-corner-br {
      bottom: 10px;
      right: 10px;
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 400;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-secondary);
      text-align: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    /* Direction Toggle */
    .direction-toggle {
      display: flex;
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
      border-radius: 0;
    }

    .direction-btn {
      flex: 1;
      padding: 1rem;
      background: var(--bg-secondary);
      border: none;
      cursor: pointer;
      font-size: 0.85rem;
      color: var(--text-secondary);
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .direction-btn:first-child {
      border-right: 1px solid var(--border-color);
    }

    .direction-btn.active {
      background: var(--accent-terracotta);
      color: white;
    }

    .direction-btn:hover:not(.active) {
      background: var(--bg-primary);
    }

    /* Form Steps */
    .step {
      margin-bottom: 1.5rem;
    }

    .step-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .step-number {
      width: 28px;
      height: 28px;
      background: var(--accent-terracotta);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .step-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-secondary);
    }

    /* Input Styling */
    input[type="datetime-local"],
    input[type="text"] {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 1px solid var(--border-color);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    input:focus {
      outline: none;
      border-color: var(--accent-terracotta);
    }

    input::placeholder {
      color: var(--text-muted);
    }

    /* Location feedback */
    .location-feedback {
      margin-top: 0.5rem;
      font-size: 0.85rem;
      min-height: 1.5rem;
    }

    .location-feedback.success {
      color: var(--accent-sage);
    }

    .location-feedback.error {
      color: var(--accent-terracotta);
    }

    .location-feedback.loading {
      color: var(--text-muted);
    }

    /* Convert Button */
    .convert-btn {
      width: 100%;
      padding: 1rem;
      background: var(--accent-terracotta);
      color: white;
      border: none;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 1rem;
    }

    .convert-btn:hover {
      background: var(--accent-brown);
    }

    .convert-btn:disabled {
      background: var(--text-muted);
      cursor: not-allowed;
    }

    /* Result Display */
    .result {
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border-color);
      display: none;
      position: relative;
    }

    /* Subtle centered diamond at result divider */
    .result::before {
      content: '';
      position: absolute;
      top: -4px;
      left: 50%;
      transform: translateX(-50%) rotate(45deg);
      width: 6px;
      height: 6px;
      background: var(--bg-card);
      border-top: 1px solid var(--border-color);
      border-left: 1px solid var(--border-color);
    }

    .result.visible {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 1rem 0;
      border-bottom: 1px solid var(--border-color);
    }

    .result-row:last-child {
      border-bottom: none;
    }

    .result-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
    }

    .result-value {
      font-size: 1.1rem;
      color: var(--text-primary);
      text-align: right;
    }

    .result-value.highlight {
      color: var(--accent-terracotta);
    }

    /* Sun Times Section */
    .sun-times {
      margin-top: 1.5rem;
      padding-top: 0.5rem;
    }

    .sun-times-header {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent-gold);
      margin-bottom: 1rem;
      text-align: center;
    }

    .sun-times-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .sun-item {
      text-align: center;
      padding: 0.75rem;
      background: var(--bg-secondary);
      border-radius: 4px;
    }

    .sun-label {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .sun-value {
      font-size: 1rem;
      font-family: 'SF Mono', 'Consolas', monospace;
      color: var(--accent-gold);
    }

    .dst-indicator {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-left: 0.5rem;
      border-radius: 2px;
    }

    .dst-indicator.active {
      background: var(--accent-gold);
      color: var(--bg-primary);
    }

    .dst-indicator.inactive {
      background: var(--accent-sage);
      color: white;
    }

    /* Footer */
    footer {
      text-align: center;
      margin-top: 2rem;
      padding-top: 1.5rem;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 1px;
      background: linear-gradient(90deg,
        transparent 0%,
        var(--border-color) 30%,
        var(--border-color) 70%,
        transparent 100%
      );
    }



    /* Responsive - iPhone optimized, fills viewport */
    @media (max-width: 600px) {
      .container {
        padding: 1rem;
      }

      header {
        margin-bottom: 0.75rem;
      }

      header::after {
        margin: 0.5rem auto 0;
        width: 120px;
      }

      h1 {
        font-size: 1.3rem;
      }

      .subtitle {
        display: none;
      }

      .clocks-strip {
        flex-direction: row;
        gap: 2rem;
        padding: 1rem;
        margin-bottom: 1rem;
      }

      .clock-item {
        padding: 0.5rem 0;
      }

      .clock-label {
        font-size: 0.65rem;
        margin-bottom: 0.25rem;
      }

      .clock-time {
        font-size: 1.4rem;
      }

      .card {
        padding: 1.25rem 1.75rem;
      }

      /* Simple corner brackets for mobile */
      .card::before {
        top: 8px;
        left: 8px;
        width: 20px;
        height: 20px;
        border-width: 1px;
      }

      .card::after {
        bottom: 8px;
        right: 8px;
        width: 20px;
        height: 20px;
        border-width: 1px;
      }

      .card-corner-tl,
      .card-corner-br {
        display: none;
      }

      .direction-toggle {
        margin-bottom: 1rem;
      }

      .direction-btn {
        padding: 0.75rem;
        font-size: 0.75rem;
      }

      .step {
        margin-bottom: 0.75rem;
      }

      .step-header {
        margin-bottom: 0.5rem;
        gap: 0.5rem;
      }

      .step-number {
        width: 24px;
        height: 24px;
        font-size: 0.75rem;
      }

      .step-label {
        font-size: 0.7rem;
      }

      input[type="text"] {
        padding: 0.75rem;
        font-size: 0.95rem;
        text-align: center;
        width: 100%;
        box-sizing: border-box;
      }

      input[type="datetime-local"] {
        padding: 0.75rem;
        font-size: 0.95rem;
        text-align: center;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        -webkit-appearance: none;
        appearance: none;
      }

      .step {
        overflow: hidden;
      }

      .location-feedback {
        min-height: 1.2rem;
        font-size: 0.75rem;
        margin-top: 0.3rem;
        text-align: center;
      }

      .convert-btn {
        margin-top: 0.5rem;
        padding: 0.875rem;
        font-size: 0.95rem;
      }

      .result {
        margin-top: 1rem;
        padding-top: 1rem;
      }

      .result-row {
        padding: 0.6rem 0;
      }

      .result-label {
        font-size: 0.65rem;
      }

      .result-value {
        font-size: 0.9rem;
      }

      .result-value.highlight {
        /* Color only, inherit font-size from .result-value */
      }

      footer {
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        gap: 0.5rem;
        flex-shrink: 0;
      }

      .detected-tz {
        font-size: 0.7rem;
      }

      .footer-btn {
        padding: 0.4rem 0.75rem;
        font-size: 0.65rem;
        width: 100px;
      }
    }
  </style>
</head>
<body>
  <div class="header-band"></div>

  <div class="container">
    <header>
      <h1>UTC Hack</h1>
    </header>

    <div class="clocks-strip">
      <div class="clock-item">
        <div class="clock-label" id="utc-label">UTC</div>
        <div class="clock-time" id="utc-clock">--:--:--</div>
      </div>
      <div class="clock-item local">
        <div class="clock-label" id="local-label">Local</div>
        <div class="clock-time" id="local-clock">--:--:--</div>
      </div>
    </div>

    <div class="card">
      <div class="card-corner-tl"></div>
      <div class="card-corner-br"></div>
      <h2 class="card-title">Time Converter</h2>
      <div class="direction-toggle">
        <button class="direction-btn active" data-direction="toLocal" onclick="setDirection('toLocal')">
          UTC â†’ Local Time
        </button>
        <button class="direction-btn" data-direction="toUTC" onclick="setDirection('toUTC')">
          Local Time â†’ UTC
        </button>
      </div>

      <div class="step">
        <div class="step-header">
          <span class="step-number">1</span>
          <span class="step-label" id="time-step-label">Enter UTC Date & Time</span>
        </div>
        <div style="position: relative;">
          <input type="text" id="time-input" readonly style="cursor: pointer;">
          <button type="button" id="datetime-picker-btn" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2rem; color: var(--accent-terracotta); font-weight: bold;">â—·</button>
        </div>
        <div id="datetime-picker" style="display: none; position: absolute; z-index: 1000; background: var(--bg-card); border: 1px solid var(--border-strong); padding: 1rem; margin-top: 0.5rem; box-shadow: 0 4px 12px var(--shadow);">
          <div style="margin-bottom: 0.5rem;">
            <label style="display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">DATE</label>
            <input type="date" id="picker-date" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary);">
          </div>
          <div style="margin-bottom: 0.5rem;">
            <label style="display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">TIME (24-HOUR)</label>
            <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.5rem; border: 1px solid var(--border-color); background: var(--bg-primary);">
              <!-- Hour Spinner -->
              <div style="display: flex; flex-direction: column; align-items: center;">
                <button type="button"
                  onmousedown="startRapidIncrement(incrementHour)"
                  onmouseup="stopRapidIncrement()"
                  onmouseleave="stopRapidIncrement()"
                  ontouchstart="startRapidIncrement(incrementHour)"
                  ontouchend="stopRapidIncrement()"
                  style="background: none; border: none; cursor: pointer; color: var(--accent-terracotta); font-size: 1.2rem; padding: 0.5rem; line-height: 1; min-width: 2.5rem; transition: opacity 0.2s;"
                  onmouseover="this.style.opacity='0.7'"
                  onmouseout="this.style.opacity='1'">â–²</button>
                <div id="picker-hour" style="font-family: 'SF Mono', 'Consolas', monospace; font-size: 1.1rem; color: var(--text-primary); min-width: 2.5rem; text-align: center; user-select: none; font-weight: 500;">00</div>
                <button type="button"
                  onmousedown="startRapidIncrement(decrementHour)"
                  onmouseup="stopRapidIncrement()"
                  onmouseleave="stopRapidIncrement()"
                  ontouchstart="startRapidIncrement(decrementHour)"
                  ontouchend="stopRapidIncrement()"
                  style="background: none; border: none; cursor: pointer; color: var(--accent-terracotta); font-size: 1.2rem; padding: 0.5rem; line-height: 1; min-width: 2.5rem; transition: opacity 0.2s;"
                  onmouseover="this.style.opacity='0.7'"
                  onmouseout="this.style.opacity='1'">â–¼</button>
              </div>

              <!-- Colon Separator -->
              <div style="font-family: 'SF Mono', 'Consolas', monospace; font-size: 1.1rem; color: var(--text-primary); font-weight: 500;">:</div>

              <!-- Minute Spinner -->
              <div style="display: flex; flex-direction: column; align-items: center;">
                <button type="button"
                  onmousedown="startRapidIncrement(incrementMinute)"
                  onmouseup="stopRapidIncrement()"
                  onmouseleave="stopRapidIncrement()"
                  ontouchstart="startRapidIncrement(incrementMinute)"
                  ontouchend="stopRapidIncrement()"
                  style="background: none; border: none; cursor: pointer; color: var(--accent-terracotta); font-size: 1.2rem; padding: 0.5rem; line-height: 1; min-width: 2.5rem; transition: opacity 0.2s;"
                  onmouseover="this.style.opacity='0.7'"
                  onmouseout="this.style.opacity='1'">â–²</button>
                <div id="picker-minute" style="font-family: 'SF Mono', 'Consolas', monospace; font-size: 1.1rem; color: var(--text-primary); min-width: 2.5rem; text-align: center; user-select: none; font-weight: 500;">00</div>
                <button type="button"
                  onmousedown="startRapidIncrement(decrementMinute)"
                  onmouseup="stopRapidIncrement()"
                  onmouseleave="stopRapidIncrement()"
                  ontouchstart="startRapidIncrement(decrementMinute)"
                  ontouchend="stopRapidIncrement()"
                  style="background: none; border: none; cursor: pointer; color: var(--accent-terracotta); font-size: 1.2rem; padding: 0.5rem; line-height: 1; min-width: 2.5rem; transition: opacity 0.2s;"
                  onmouseover="this.style.opacity='0.7'"
                  onmouseout="this.style.opacity='1'">â–¼</button>
              </div>
            </div>
          </div>
          <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
            <button type="button" onclick="closeDateTimePicker()" style="padding: 0.5rem 1rem; background: var(--bg-secondary); border: 1px solid var(--border-color); cursor: pointer; color: var(--text-primary);">Cancel</button>
            <button type="button" onclick="applyDateTime()" style="padding: 0.5rem 1rem; background: var(--accent-terracotta); border: none; cursor: pointer; color: white;">Apply</button>
          </div>
        </div>
        <div id="disambiguation-container" style="display: none; margin-top: 0.75rem; padding: 0.75rem; border: 1px dashed var(--border-color); border-radius: 8px; background: var(--bg-secondary);">
          <label for="disambiguation-select" id="disambiguation-label" style="display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.35rem;">Ambiguous local time handling</label>
          <select id="disambiguation-select" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary);">
            <option id="disambiguation-option-reject" value="reject">Reject invalid/ambiguous times</option>
            <option id="disambiguation-option-compatible" value="compatible">Compatible (advance during gaps)</option>
            <option id="disambiguation-option-earlier" value="earlier">Earlier (first occurrence)</option>
            <option id="disambiguation-option-later" value="later">Later (second occurrence)</option>
          </select>
          <div id="disambiguation-help" style="margin-top: 0.4rem; font-size: 0.75rem; color: var(--text-muted);">Used during DST fall-back/forward when local times overlap or do not exist.</div>
        </div>
      </div>

      <div class="step">
        <div class="step-header">
          <span class="step-number">2</span>
          <span class="step-label" id="location-step-label">Enter Location (any city or town)</span>
        </div>
        <input type="text" id="location-input" placeholder="e.g., Lincoln, Montana or Missoula, MT">
        <div class="location-feedback" id="location-feedback"></div>
      </div>

      <button class="convert-btn" id="convert-btn" onclick="convert()">Convert</button>

      <div class="result" id="result">
        <div class="result-row">
          <div class="result-label" id="result-location-label">Location</div>
          <div class="result-value" id="result-location">â€”</div>
        </div>
        <div class="result-row">
          <div class="result-label" id="result-timezone-label">Timezone</div>
          <div class="result-value" id="result-timezone">â€”</div>
        </div>
        <div class="result-row">
          <div class="result-label" id="result-utc-label">UTC Time</div>
          <div class="result-value" id="result-utc">â€”</div>
        </div>
        <div class="result-row">
          <div class="result-label" id="result-local-label">Local Time</div>
          <div class="result-value highlight" id="result-local">â€”</div>
        </div>
        <div class="sun-times" id="sun-times" style="display: none;">
          <div class="sun-times-header" id="sun-times-header">Sun Times (for selected date)</div>
          <div class="sun-times-grid">
            <div class="sun-item">
              <div class="sun-label" id="civil-dawn-label">Civil Dawn</div>
              <div class="sun-value" id="civil-dawn-time">â€”</div>
            </div>
            <div class="sun-item">
              <div class="sun-label" id="sunrise-label">Sunrise</div>
              <div class="sun-value" id="sunrise-time">â€”</div>
            </div>
            <div class="sun-item">
              <div class="sun-label" id="sunset-label">Sunset</div>
              <div class="sun-value" id="sunset-time">â€”</div>
            </div>
            <div class="sun-item">
              <div class="sun-label" id="civil-dusk-label">Civil Dusk</div>
              <div class="sun-value" id="civil-dusk-time">â€”</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <button class="footer-btn" onclick="toggleTheme()">
        <span id="theme-icon">â˜€ï¸</span>
        <span id="theme-label">Light</span>
      </button>
      <a href="https://buymeacoffee.com/gpdx" target="_blank" rel="noopener noreferrer" class="footer-btn">
        ğŸ’² Donate
      </a>
    </footer>
  </div>

  <script>
    // Translations for all supported languages
    const translations = {
      en: {
        timeConverter: 'Time Converter',
        utc: 'UTC',
        local: 'Local',
        utcToLocal: 'UTC â†’ Local Time',
        localToUtc: 'Local Time â†’ UTC',
        enterUtcDateTime: 'Enter UTC Date & Time',
        enterLocalDateTime: 'Enter Local Date & Time',
        enterLocation: 'Enter Location (any city, town, or airport code)',
        locationPlaceholder: 'e.g., Lincoln, Montana or KJFK',
        convert: 'Convert',
        location: 'Location',
        timezone: 'Timezone',
        utcTime: 'UTC Time',
        localTime: 'Local Time',
        utcTimeInput: 'UTC Time (input)',
        localTimeResult: 'Local Time (result)',
        utcTimeResult: 'UTC Time (result)',
        localTimeInput: 'Local Time (input)',
        detectedTimezone: 'Your detected timezone:',
        light: 'Light',
        dark: 'Dark',
        lookingUp: 'Looking up...',
        locationNotFound: 'Location not found',
        lookupFailed: 'Lookup failed â€” try again',
        dst: 'DST',
        noDst: 'No DST',
        sunTimesHeader: 'Sun Times (for selected date)',
        disambiguationLabel: 'Ambiguous local time handling',
        disambiguationHelp: 'Used during DST fall-back/forward when local times overlap or do not exist.',
        disambiguationReject: 'Reject invalid/ambiguous times',
        disambiguationCompatible: 'Compatible (advance during gaps)',
        disambiguationEarlier: 'Earlier (first occurrence)',
        disambiguationLater: 'Later (second occurrence)',
        civilDawn: 'Civil Dawn',
        sunrise: 'Sunrise',
        sunset: 'Sunset',
        civilDusk: 'Civil Dusk'
      },
      de: {
        timeConverter: 'Zeitumrechner',
        utc: 'UTC',
        local: 'Lokal',
        utcToLocal: 'UTC â†’ Ortszeit',
        localToUtc: 'Ortszeit â†’ UTC',
        enterUtcDateTime: 'UTC-Datum & Zeit eingeben',
        enterLocalDateTime: 'Lokales Datum & Zeit eingeben',
        enterLocation: 'Ort oder Flughafencode eingeben',
        locationPlaceholder: 'z.B. Berlin, MÃ¼nchen oder EDDF',
        convert: 'Umrechnen',
        location: 'Ort',
        timezone: 'Zeitzone',
        utcTime: 'UTC-Zeit',
        localTime: 'Ortszeit',
        utcTimeInput: 'UTC-Zeit (Eingabe)',
        localTimeResult: 'Ortszeit (Ergebnis)',
        utcTimeResult: 'UTC-Zeit (Ergebnis)',
        localTimeInput: 'Ortszeit (Eingabe)',
        detectedTimezone: 'Erkannte Zeitzone:',
        light: 'Hell',
        dark: 'Dunkel',
        lookingUp: 'Suche...',
        locationNotFound: 'Ort nicht gefunden',
        lookupFailed: 'Suche fehlgeschlagen',
        dst: 'Sommerzeit',
        noDst: 'Keine Sommerzeit',
        sunTimesHeader: 'Sonnenzeiten (fÃ¼r gewÃ¤hltes Datum)',
        civilDawn: 'BÃ¼rgerliche DÃ¤mmerung',
        sunrise: 'Sonnenaufgang',
        sunset: 'Sonnenuntergang',
        civilDusk: 'BÃ¼rgerliche AbenddÃ¤mmerung'
      },
      fr: {
        timeConverter: 'Convertisseur horaire',
        utc: 'UTC',
        local: 'Local',
        utcToLocal: 'UTC â†’ Heure locale',
        localToUtc: 'Heure locale â†’ UTC',
        enterUtcDateTime: 'Entrer date et heure UTC',
        enterLocalDateTime: 'Entrer date et heure locale',
        enterLocation: 'Entrer un lieu ou code aÃ©roport',
        locationPlaceholder: 'ex: Paris, Lyon ou LFPG',
        convert: 'Convertir',
        location: 'Lieu',
        timezone: 'Fuseau horaire',
        utcTime: 'Heure UTC',
        localTime: 'Heure locale',
        utcTimeInput: 'Heure UTC (entrÃ©e)',
        localTimeResult: 'Heure locale (rÃ©sultat)',
        utcTimeResult: 'Heure UTC (rÃ©sultat)',
        localTimeInput: 'Heure locale (entrÃ©e)',
        detectedTimezone: 'Fuseau horaire dÃ©tectÃ©:',
        light: 'Clair',
        dark: 'Sombre',
        lookingUp: 'Recherche...',
        locationNotFound: 'Lieu non trouvÃ©',
        lookupFailed: 'Ã‰chec de la recherche',
        dst: 'Heure d\'Ã©tÃ©',
        noDst: 'Pas d\'heure d\'Ã©tÃ©',
        sunTimesHeader: 'Heures du soleil (pour la date sÃ©lectionnÃ©e)',
        civilDawn: 'Aube civile',
        sunrise: 'Lever du soleil',
        sunset: 'Coucher du soleil',
        civilDusk: 'CrÃ©puscule civil'
      },
      es: {
        timeConverter: 'Convertidor horario',
        utc: 'UTC',
        local: 'Local',
        utcToLocal: 'UTC â†’ Hora local',
        localToUtc: 'Hora local â†’ UTC',
        enterUtcDateTime: 'Ingrese fecha y hora UTC',
        enterLocalDateTime: 'Ingrese fecha y hora local',
        enterLocation: 'Ingrese ubicaciÃ³n o cÃ³digo de aeropuerto',
        locationPlaceholder: 'ej: Madrid, MÃ©xico DF o LEMD',
        convert: 'Convertir',
        location: 'UbicaciÃ³n',
        timezone: 'Zona horaria',
        utcTime: 'Hora UTC',
        localTime: 'Hora local',
        utcTimeInput: 'Hora UTC (entrada)',
        localTimeResult: 'Hora local (resultado)',
        utcTimeResult: 'Hora UTC (resultado)',
        localTimeInput: 'Hora local (entrada)',
        detectedTimezone: 'Zona horaria detectada:',
        light: 'Claro',
        dark: 'Oscuro',
        lookingUp: 'Buscando...',
        locationNotFound: 'UbicaciÃ³n no encontrada',
        lookupFailed: 'Error en la bÃºsqueda',
        dst: 'Horario de verano',
        noDst: 'Sin horario de verano',
        sunTimesHeader: 'Horas del sol (para fecha seleccionada)',
        civilDawn: 'Amanecer civil',
        sunrise: 'Salida del sol',
        sunset: 'Puesta del sol',
        civilDusk: 'CrepÃºsculo civil'
      },
      pt: {
        timeConverter: 'Conversor de horÃ¡rio',
        utc: 'UTC',
        local: 'Local',
        utcToLocal: 'UTC â†’ Hora local',
        localToUtc: 'Hora local â†’ UTC',
        enterUtcDateTime: 'Digite data e hora UTC',
        enterLocalDateTime: 'Digite data e hora local',
        enterLocation: 'Digite localizaÃ§Ã£o ou cÃ³digo do aeroporto',
        locationPlaceholder: 'ex: SÃ£o Paulo, Rio de Janeiro ou SBGR',
        convert: 'Converter',
        location: 'LocalizaÃ§Ã£o',
        timezone: 'Fuso horÃ¡rio',
        utcTime: 'Hora UTC',
        localTime: 'Hora local',
        utcTimeInput: 'Hora UTC (entrada)',
        localTimeResult: 'Hora local (resultado)',
        utcTimeResult: 'Hora UTC (resultado)',
        localTimeInput: 'Hora local (entrada)',
        detectedTimezone: 'Fuso horÃ¡rio detectado:',
        light: 'Claro',
        dark: 'Escuro',
        lookingUp: 'Procurando...',
        locationNotFound: 'Local nÃ£o encontrado',
        lookupFailed: 'Falha na busca',
        dst: 'HorÃ¡rio de verÃ£o',
        noDst: 'Sem horÃ¡rio de verÃ£o',
        sunTimesHeader: 'HorÃ¡rios do sol (para data selecionada)',
        civilDawn: 'Aurora civil',
        sunrise: 'Nascer do sol',
        sunset: 'PÃ´r do sol',
        civilDusk: 'CrepÃºsculo civil'
      },
      it: {
        timeConverter: 'Convertitore orario',
        utc: 'UTC',
        local: 'Locale',
        utcToLocal: 'UTC â†’ Ora locale',
        localToUtc: 'Ora locale â†’ UTC',
        enterUtcDateTime: 'Inserisci data e ora UTC',
        enterLocalDateTime: 'Inserisci data e ora locale',
        enterLocation: 'Inserisci localitÃ  o codice aeroporto',
        locationPlaceholder: 'es: Roma, Milano o LIRF',
        convert: 'Converti',
        location: 'LocalitÃ ',
        timezone: 'Fuso orario',
        utcTime: 'Ora UTC',
        localTime: 'Ora locale',
        utcTimeInput: 'Ora UTC (input)',
        localTimeResult: 'Ora locale (risultato)',
        utcTimeResult: 'Ora UTC (risultato)',
        localTimeInput: 'Ora locale (input)',
        detectedTimezone: 'Fuso orario rilevato:',
        light: 'Chiaro',
        dark: 'Scuro',
        lookingUp: 'Ricerca...',
        locationNotFound: 'LocalitÃ  non trovata',
        lookupFailed: 'Ricerca fallita',
        dst: 'Ora legale',
        noDst: 'Nessuna ora legale',
        sunTimesHeader: 'Orari del sole (per data selezionata)',
        civilDawn: 'Alba civile',
        sunrise: 'Alba',
        sunset: 'Tramonto',
        civilDusk: 'Crepuscolo civile'
      },
      pl: {
        timeConverter: 'Konwerter czasu',
        utc: 'UTC',
        local: 'Lokalny',
        utcToLocal: 'UTC â†’ Czas lokalny',
        localToUtc: 'Czas lokalny â†’ UTC',
        enterUtcDateTime: 'WprowadÅº datÄ™ i czas UTC',
        enterLocalDateTime: 'WprowadÅº lokalnÄ… datÄ™ i czas',
        enterLocation: 'WprowadÅº lokalizacjÄ™ lub kod lotniska',
        locationPlaceholder: 'np. Warszawa, KrakÃ³w lub EPWA',
        convert: 'Konwertuj',
        location: 'Lokalizacja',
        timezone: 'Strefa czasowa',
        utcTime: 'Czas UTC',
        localTime: 'Czas lokalny',
        utcTimeInput: 'Czas UTC (wejÅ›cie)',
        localTimeResult: 'Czas lokalny (wynik)',
        utcTimeResult: 'Czas UTC (wynik)',
        localTimeInput: 'Czas lokalny (wejÅ›cie)',
        detectedTimezone: 'Wykryta strefa czasowa:',
        light: 'Jasny',
        dark: 'Ciemny',
        lookingUp: 'Szukam...',
        locationNotFound: 'Nie znaleziono lokalizacji',
        lookupFailed: 'Wyszukiwanie nie powiodÅ‚o siÄ™',
        dst: 'Czas letni',
        noDst: 'Bez czasu letniego',
        sunTimesHeader: 'Godziny sÅ‚oneczne (dla wybranej daty)',
        civilDawn: 'Åšwit cywilny',
        sunrise: 'WschÃ³d sÅ‚oÅ„ca',
        sunset: 'ZachÃ³d sÅ‚oÅ„ca',
        civilDusk: 'Zmierzch cywilny'
      },
      nl: {
        timeConverter: 'Tijdconverter',
        utc: 'UTC',
        local: 'Lokaal',
        utcToLocal: 'UTC â†’ Lokale tijd',
        localToUtc: 'Lokale tijd â†’ UTC',
        enterUtcDateTime: 'Voer UTC-datum en tijd in',
        enterLocalDateTime: 'Voer lokale datum en tijd in',
        enterLocation: 'Voer locatie of luchthavencode in',
        locationPlaceholder: 'bijv. Amsterdam, Rotterdam of EHAM',
        convert: 'Converteren',
        location: 'Locatie',
        timezone: 'Tijdzone',
        utcTime: 'UTC-tijd',
        localTime: 'Lokale tijd',
        utcTimeInput: 'UTC-tijd (invoer)',
        localTimeResult: 'Lokale tijd (resultaat)',
        utcTimeResult: 'UTC-tijd (resultaat)',
        localTimeInput: 'Lokale tijd (invoer)',
        detectedTimezone: 'Gedetecteerde tijdzone:',
        light: 'Licht',
        dark: 'Donker',
        lookingUp: 'Zoeken...',
        locationNotFound: 'Locatie niet gevonden',
        lookupFailed: 'Zoeken mislukt',
        dst: 'Zomertijd',
        noDst: 'Geen zomertijd',
        sunTimesHeader: 'Zonnetijden (voor geselecteerde datum)',
        civilDawn: 'Burgerlijke dageraad',
        sunrise: 'Zonsopgang',
        sunset: 'Zonsondergang',
        civilDusk: 'Burgerlijke schemering'
      },
      ru: {
        timeConverter: 'ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚ĞµÑ€ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸',
        utc: 'UTC',
        local: 'ĞœĞµÑÑ‚Ğ½Ğ¾Ğµ',
        utcToLocal: 'UTC â†’ ĞœĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ',
        localToUtc: 'ĞœĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ â†’ UTC',
        enterUtcDateTime: 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ´Ğ°Ñ‚Ñƒ Ğ¸ Ğ²Ñ€ĞµĞ¼Ñ UTC',
        enterLocalDateTime: 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¼ĞµÑÑ‚Ğ½ÑƒÑ Ğ´Ğ°Ñ‚Ñƒ Ğ¸ Ğ²Ñ€ĞµĞ¼Ñ',
        enterLocation: 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¼ĞµÑÑ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ´ Ğ°ÑÑ€Ğ¾Ğ¿Ğ¾Ñ€Ñ‚Ğ°',
        locationPlaceholder: 'Ğ½Ğ°Ğ¿Ñ€. ĞœĞ¾ÑĞºĞ²Ğ°, Ğ¡Ğ°Ğ½ĞºÑ‚-ĞŸĞµÑ‚ĞµÑ€Ğ±ÑƒÑ€Ğ³ Ğ¸Ğ»Ğ¸ UUEE',
        convert: 'ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ',
        location: 'ĞœĞµÑÑ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ',
        timezone: 'Ğ§Ğ°ÑĞ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾ÑÑ',
        utcTime: 'Ğ’Ñ€ĞµĞ¼Ñ UTC',
        localTime: 'ĞœĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ',
        utcTimeInput: 'Ğ’Ñ€ĞµĞ¼Ñ UTC (Ğ²Ğ²Ğ¾Ğ´)',
        localTimeResult: 'ĞœĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ (Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚)',
        utcTimeResult: 'Ğ’Ñ€ĞµĞ¼Ñ UTC (Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚)',
        localTimeInput: 'ĞœĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ (Ğ²Ğ²Ğ¾Ğ´)',
        detectedTimezone: 'ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ñ‹Ğ¹ Ñ‡Ğ°ÑĞ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾ÑÑ:',
        light: 'Ğ¡Ğ²ĞµÑ‚Ğ»Ğ°Ñ',
        dark: 'Ğ¢Ñ‘Ğ¼Ğ½Ğ°Ñ',
        lookingUp: 'ĞŸĞ¾Ğ¸ÑĞº...',
        locationNotFound: 'ĞœĞµÑÑ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾',
        lookupFailed: 'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ¸ÑĞºĞ°',
        dst: 'Ğ›ĞµÑ‚Ğ½ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ',
        noDst: 'Ğ‘ĞµĞ· Ğ»ĞµÑ‚Ğ½ĞµĞ³Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸',
        sunTimesHeader: 'Ğ’Ñ€ĞµĞ¼Ñ ÑĞ¾Ğ»Ğ½Ñ†Ğ° (Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ´Ğ°Ñ‚Ñ‹)',
        civilDawn: 'Ğ“Ñ€Ğ°Ğ¶Ğ´Ğ°Ğ½ÑĞºĞ¸Ğ¹ Ñ€Ğ°ÑÑĞ²ĞµÑ‚',
        sunrise: 'Ğ’Ğ¾ÑÑ…Ğ¾Ğ´',
        sunset: 'Ğ—Ğ°ĞºĞ°Ñ‚',
        civilDusk: 'Ğ“Ñ€Ğ°Ğ¶Ğ´Ğ°Ğ½ÑĞºĞ¸Ğµ ÑÑƒĞ¼ĞµÑ€ĞºĞ¸'
      },
      ja: {
        timeConverter: 'æ™‚é–“å¤‰æ›',
        utc: 'UTC',
        local: 'ç¾åœ°',
        utcToLocal: 'UTC â†’ ç¾åœ°æ™‚é–“',
        localToUtc: 'ç¾åœ°æ™‚é–“ â†’ UTC',
        enterUtcDateTime: 'UTCæ—¥æ™‚ã‚’å…¥åŠ›',
        enterLocalDateTime: 'ç¾åœ°æ—¥æ™‚ã‚’å…¥åŠ›',
        enterLocation: 'å ´æ‰€ã¾ãŸã¯ç©ºæ¸¯ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›',
        locationPlaceholder: 'ä¾‹ï¼šæ±äº¬ã€å¤§é˜ªã€RJTT',
        convert: 'å¤‰æ›',
        location: 'å ´æ‰€',
        timezone: 'ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³',
        utcTime: 'UTCæ™‚é–“',
        localTime: 'ç¾åœ°æ™‚é–“',
        utcTimeInput: 'UTCæ™‚é–“ï¼ˆå…¥åŠ›ï¼‰',
        localTimeResult: 'ç¾åœ°æ™‚é–“ï¼ˆçµæœï¼‰',
        utcTimeResult: 'UTCæ™‚é–“ï¼ˆçµæœï¼‰',
        localTimeInput: 'ç¾åœ°æ™‚é–“ï¼ˆå…¥åŠ›ï¼‰',
        detectedTimezone: 'æ¤œå‡ºã•ã‚ŒãŸã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ï¼š',
        light: 'ãƒ©ã‚¤ãƒˆ',
        dark: 'ãƒ€ãƒ¼ã‚¯',
        lookingUp: 'æ¤œç´¢ä¸­...',
        locationNotFound: 'å ´æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
        lookupFailed: 'æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ',
        dst: 'å¤æ™‚é–“',
        noDst: 'å¤æ™‚é–“ãªã—',
        sunTimesHeader: 'å¤ªé™½æ™‚åˆ»ï¼ˆé¸æŠã—ãŸæ—¥ä»˜ï¼‰',
        civilDawn: 'å¸‚æ°‘è–„æ˜',
        sunrise: 'æ—¥ã®å‡º',
        sunset: 'æ—¥ã®å…¥ã‚Š',
        civilDusk: 'å¸‚æ°‘è–„æš®'
      },
      zh: {
        timeConverter: 'æ—¶é—´è½¬æ¢å™¨',
        utc: 'UTC',
        local: 'æœ¬åœ°',
        utcToLocal: 'UTC â†’ æœ¬åœ°æ—¶é—´',
        localToUtc: 'æœ¬åœ°æ—¶é—´ â†’ UTC',
        enterUtcDateTime: 'è¾“å…¥UTCæ—¥æœŸå’Œæ—¶é—´',
        enterLocalDateTime: 'è¾“å…¥æœ¬åœ°æ—¥æœŸå’Œæ—¶é—´',
        enterLocation: 'è¾“å…¥ä½ç½®æˆ–æœºåœºä»£ç ',
        locationPlaceholder: 'ä¾‹å¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€ZBAA',
        convert: 'è½¬æ¢',
        location: 'ä½ç½®',
        timezone: 'æ—¶åŒº',
        utcTime: 'UTCæ—¶é—´',
        localTime: 'æœ¬åœ°æ—¶é—´',
        utcTimeInput: 'UTCæ—¶é—´ï¼ˆè¾“å…¥ï¼‰',
        localTimeResult: 'æœ¬åœ°æ—¶é—´ï¼ˆç»“æœï¼‰',
        utcTimeResult: 'UTCæ—¶é—´ï¼ˆç»“æœï¼‰',
        localTimeInput: 'æœ¬åœ°æ—¶é—´ï¼ˆè¾“å…¥ï¼‰',
        detectedTimezone: 'æ£€æµ‹åˆ°çš„æ—¶åŒºï¼š',
        light: 'æµ…è‰²',
        dark: 'æ·±è‰²',
        lookingUp: 'æœç´¢ä¸­...',
        locationNotFound: 'æœªæ‰¾åˆ°ä½ç½®',
        lookupFailed: 'æœç´¢å¤±è´¥',
        dst: 'å¤ä»¤æ—¶',
        noDst: 'æ— å¤ä»¤æ—¶',
        sunTimesHeader: 'å¤ªé˜³æ—¶é—´ï¼ˆæ‰€é€‰æ—¥æœŸï¼‰',
        civilDawn: 'æ°‘ç”¨æ›™å…‰',
        sunrise: 'æ—¥å‡º',
        sunset: 'æ—¥è½',
        civilDusk: 'æ°‘ç”¨æš®å…‰'
      },
      ko: {
        timeConverter: 'ì‹œê°„ ë³€í™˜ê¸°',
        utc: 'UTC',
        local: 'í˜„ì§€',
        utcToLocal: 'UTC â†’ í˜„ì§€ ì‹œê°„',
        localToUtc: 'í˜„ì§€ ì‹œê°„ â†’ UTC',
        enterUtcDateTime: 'UTC ë‚ ì§œ ë° ì‹œê°„ ì…ë ¥',
        enterLocalDateTime: 'í˜„ì§€ ë‚ ì§œ ë° ì‹œê°„ ì…ë ¥',
        enterLocation: 'ìœ„ì¹˜ ë˜ëŠ” ê³µí•­ ì½”ë“œ ì…ë ¥',
        locationPlaceholder: 'ì˜ˆ: ì„œìš¸, ë¶€ì‚°, RKSI',
        convert: 'ë³€í™˜',
        location: 'ìœ„ì¹˜',
        timezone: 'ì‹œê°„ëŒ€',
        utcTime: 'UTC ì‹œê°„',
        localTime: 'í˜„ì§€ ì‹œê°„',
        utcTimeInput: 'UTC ì‹œê°„ (ì…ë ¥)',
        localTimeResult: 'í˜„ì§€ ì‹œê°„ (ê²°ê³¼)',
        utcTimeResult: 'UTC ì‹œê°„ (ê²°ê³¼)',
        localTimeInput: 'í˜„ì§€ ì‹œê°„ (ì…ë ¥)',
        detectedTimezone: 'ê°ì§€ëœ ì‹œê°„ëŒ€:',
        light: 'ë¼ì´íŠ¸',
        dark: 'ë‹¤í¬',
        lookingUp: 'ê²€ìƒ‰ ì¤‘...',
        locationNotFound: 'ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ',
        lookupFailed: 'ê²€ìƒ‰ ì‹¤íŒ¨',
        dst: 'ì¼ê´‘ ì ˆì•½ ì‹œê°„',
        noDst: 'ì¼ê´‘ ì ˆì•½ ì‹œê°„ ì—†ìŒ',
        sunTimesHeader: 'íƒœì–‘ ì‹œê°„ (ì„ íƒí•œ ë‚ ì§œ)',
        civilDawn: 'ì‹œë¯¼ ë°•ëª…',
        sunrise: 'ì¼ì¶œ',
        sunset: 'ì¼ëª°',
        civilDusk: 'ì‹œë¯¼ í™©í˜¼'
      },
      ar: {
        timeConverter: 'Ù…Ø­ÙˆÙ„ Ø§Ù„ÙˆÙ‚Øª',
        utc: 'UTC',
        local: 'Ù…Ø­Ù„ÙŠ',
        utcToLocal: 'UTC â† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ù„ÙŠ',
        localToUtc: 'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ù„ÙŠ â† UTC',
        enterUtcDateTime: 'Ø£Ø¯Ø®Ù„ ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª UTC',
        enterLocalDateTime: 'Ø£Ø¯Ø®Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ù„ÙŠ',
        enterLocation: 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø±Ù…Ø² Ø§Ù„Ù…Ø·Ø§Ø±',
        locationPlaceholder: 'Ù…Ø«Ø§Ù„: Ø¯Ø¨ÙŠØŒ Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ OMDB',
        convert: 'ØªØ­ÙˆÙŠÙ„',
        location: 'Ø§Ù„Ù…ÙˆÙ‚Ø¹',
        timezone: 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©',
        utcTime: 'ÙˆÙ‚Øª UTC',
        localTime: 'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ù„ÙŠ',
        utcTimeInput: 'ÙˆÙ‚Øª UTC (Ø¥Ø¯Ø®Ø§Ù„)',
        localTimeResult: 'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ù„ÙŠ (Ø§Ù„Ù†ØªÙŠØ¬Ø©)',
        utcTimeResult: 'ÙˆÙ‚Øª UTC (Ø§Ù„Ù†ØªÙŠØ¬Ø©)',
        localTimeInput: 'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ù„ÙŠ (Ø¥Ø¯Ø®Ø§Ù„)',
        detectedTimezone: 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø§Ù„Ù…ÙƒØªØ´ÙØ©:',
        light: 'ÙØ§ØªØ­',
        dark: 'Ø¯Ø§ÙƒÙ†',
        lookingUp: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...',
        locationNotFound: 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯',
        lookupFailed: 'ÙØ´Ù„ Ø§Ù„Ø¨Ø­Ø«',
        dst: 'Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„ØµÙŠÙÙŠ',
        noDst: 'Ø¨Ø¯ÙˆÙ† ØªÙˆÙ‚ÙŠØª ØµÙŠÙÙŠ',
        sunTimesHeader: 'Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø´Ù…Ø³ (Ù„Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯)',
        civilDawn: 'Ø§Ù„ÙØ¬Ø± Ø§Ù„Ù…Ø¯Ù†ÙŠ',
        sunrise: 'Ø´Ø±ÙˆÙ‚ Ø§Ù„Ø´Ù…Ø³',
        sunset: 'ØºØ±ÙˆØ¨ Ø§Ù„Ø´Ù…Ø³',
        civilDusk: 'Ø§Ù„ØºØ³Ù‚ Ø§Ù„Ù…Ø¯Ù†ÙŠ'
      }
    };

    // Detect language from URL path
    const supportedLangs = ['en', 'de', 'fr', 'es', 'pt', 'it', 'pl', 'nl', 'ru', 'ja', 'zh', 'ko', 'ar'];
    const pathLang = window.location.pathname.split('/')[1];
    const currentLang = supportedLangs.includes(pathLang) ? pathLang : 'en';
    const t = translations[currentLang];
    const base = translations.en;

    // State
    let currentDirection = 'toLocal';
    let resolvedTimezone = null;
    let resolvedDisplayName = null;
    let resolvedSunTimes = null;
    const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

    // Apply translations to the page
    function applyTranslations() {
      try {
        // Clock labels
        document.getElementById('utc-label').textContent = t.utc;
        document.getElementById('local-label').textContent = t.local;

        // Card title
        document.querySelector('.card-title').textContent = t.timeConverter;

        // Direction buttons
        document.querySelector('[data-direction="toLocal"]').textContent = t.utcToLocal;
        document.querySelector('[data-direction="toUTC"]').textContent = t.localToUtc;

        // Step labels
        document.getElementById('time-step-label').textContent = t.enterUtcDateTime;
        document.getElementById('location-step-label').textContent = t.enterLocation;

        // Input placeholder
        document.getElementById('location-input').placeholder = t.locationPlaceholder;

        // Convert button
        document.getElementById('convert-btn').textContent = t.convert;

        // Result labels
        document.getElementById('result-location-label').textContent = t.location;
        document.getElementById('result-timezone-label').textContent = t.timezone;
        document.getElementById('result-utc-label').textContent = t.utcTime;
        document.getElementById('result-local-label').textContent = t.localTime;

        // Footer
        document.getElementById('theme-label').textContent = t.light;

        // Sun times labels
        document.getElementById('sun-times-header').textContent = t.sunTimesHeader;
        document.getElementById('civil-dawn-label').textContent = t.civilDawn;
        document.getElementById('sunrise-label').textContent = t.sunrise;
        document.getElementById('sunset-label').textContent = t.sunset;
        document.getElementById('civil-dusk-label').textContent = t.civilDusk;

        // Disambiguation UI (fallback to English if missing)
        document.getElementById('disambiguation-label').textContent = t.disambiguationLabel || base.disambiguationLabel;
        document.getElementById('disambiguation-help').textContent = t.disambiguationHelp || base.disambiguationHelp;
        document.getElementById('disambiguation-option-reject').textContent = t.disambiguationReject || base.disambiguationReject;
        document.getElementById('disambiguation-option-compatible').textContent = t.disambiguationCompatible || base.disambiguationCompatible;
        document.getElementById('disambiguation-option-earlier').textContent = t.disambiguationEarlier || base.disambiguationEarlier;
        document.getElementById('disambiguation-option-later').textContent = t.disambiguationLater || base.disambiguationLater;

        // Set HTML lang attribute
        document.documentElement.lang = currentLang;

        // Set text direction for Arabic
        if (currentLang === 'ar') {
          document.documentElement.dir = 'rtl';
        }
      } catch (e) {
        console.error('Translation error:', e);
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      applyTranslations();
      updateClocks();
      setInterval(updateClocks, 1000);
      setDefaultTime();

      // Load saved theme
      const savedTheme = localStorage.getItem('theme') || 'light';
      setTheme(savedTheme);

      // Location input with debounce
      document.getElementById('location-input').addEventListener('input', debounce(lookupLocation, 400));

      // DateTime picker events
      document.getElementById('time-input').addEventListener('click', openDateTimePicker);
      document.getElementById('datetime-picker-btn').addEventListener('click', openDateTimePicker);

      // Close picker when clicking outside
      document.addEventListener('click', (e) => {
        const picker = document.getElementById('datetime-picker');
        const timeInput = document.getElementById('time-input');
        const pickerBtn = document.getElementById('datetime-picker-btn');

        if (!picker.contains(e.target) && e.target !== timeInput && e.target !== pickerBtn) {
          closeDateTimePicker();
        }
      });
    });

    function updateClocks() {
      const now = new Date();
      document.getElementById('utc-clock').textContent = now.toLocaleTimeString('en-US', {
        timeZone: 'UTC', hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
      document.getElementById('local-clock').textContent = now.toLocaleTimeString('en-US', {
        hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
    }

    // Store current datetime value
    let currentDateTime = new Date();

    function setDefaultTime() {
      currentDateTime = new Date();
      updateDateTimeDisplay();
    }

    function updateDateTimeDisplay() {
      const timeInput = document.getElementById('time-input');
      // Format: MM/DD/YYYY, HH:MM (24-hour)
      const month = String(currentDateTime.getUTCMonth() + 1).padStart(2, '0');
      const day = String(currentDateTime.getUTCDate()).padStart(2, '0');
      const year = currentDateTime.getUTCFullYear();
      const hours = String(currentDateTime.getUTCHours()).padStart(2, '0');
      const minutes = String(currentDateTime.getUTCMinutes()).padStart(2, '0');

      timeInput.value = `${month}/${day}/${year}, ${hours}:${minutes}`;
    }

    // Spinner state
    let pickerHourValue = 0;
    let pickerMinuteValue = 0;
    let incrementInterval = null;

    function incrementHour() {
      pickerHourValue = (pickerHourValue + 1) % 24;
      updateSpinnerDisplay();
    }

    function decrementHour() {
      pickerHourValue = (pickerHourValue - 1 + 24) % 24;
      updateSpinnerDisplay();
    }

    function incrementMinute() {
      pickerMinuteValue = (pickerMinuteValue + 1) % 60;
      updateSpinnerDisplay();
    }

    function decrementMinute() {
      pickerMinuteValue = (pickerMinuteValue - 1 + 60) % 60;
      updateSpinnerDisplay();
    }

    function updateSpinnerDisplay() {
      const hourEl = document.getElementById('picker-hour');
      const minuteEl = document.getElementById('picker-minute');
      if (hourEl) hourEl.textContent = String(pickerHourValue).padStart(2, '0');
      if (minuteEl) minuteEl.textContent = String(pickerMinuteValue).padStart(2, '0');
    }

    // Rapid increment on hold
    function startRapidIncrement(fn) {
      fn(); // Execute immediately
      incrementInterval = setInterval(fn, 100); // Then repeat
    }

    function stopRapidIncrement() {
      if (incrementInterval) {
        clearInterval(incrementInterval);
        incrementInterval = null;
      }
    }

    function openDateTimePicker() {
      const picker = document.getElementById('datetime-picker');
      const pickerDate = document.getElementById('picker-date');

      // Set picker values from current datetime
      pickerDate.value = currentDateTime.toISOString().slice(0, 10);
      pickerHourValue = currentDateTime.getUTCHours();
      pickerMinuteValue = currentDateTime.getUTCMinutes();
      updateSpinnerDisplay();

      picker.style.display = 'block';
    }

    function closeDateTimePicker() {
      document.getElementById('datetime-picker').style.display = 'none';
    }

    function applyDateTime() {
      const pickerDate = document.getElementById('picker-date').value;

      if (pickerDate) {
        // Combine date with spinner time values
        // CRITICAL: Add 'Z' suffix to force UTC interpretation (prevent browser timezone shift)
        const timeString = `${String(pickerHourValue).padStart(2, '0')}:${String(pickerMinuteValue).padStart(2, '0')}`;
        currentDateTime = new Date(`${pickerDate}T${timeString}:00Z`);
        updateDateTimeDisplay();
      }

      closeDateTimePicker();
    }

    function setDirection(dir) {
      currentDirection = dir;
      document.querySelectorAll('.direction-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.direction === dir);
      });

      // Update labels
      const timeLabel = document.getElementById('time-step-label');
      const resultUtcLabel = document.getElementById('result-utc-label');
      const resultLocalLabel = document.getElementById('result-local-label');
      const disambiguationContainer = document.getElementById('disambiguation-container');

      if (dir === 'toLocal') {
        timeLabel.textContent = t.enterUtcDateTime;
        resultUtcLabel.textContent = t.utcTimeInput;
        resultLocalLabel.textContent = t.localTimeResult;
        disambiguationContainer.style.display = 'none';
      } else {
        timeLabel.textContent = t.enterLocalDateTime;
        resultUtcLabel.textContent = t.utcTimeResult;
        resultLocalLabel.textContent = t.localTimeInput;
        disambiguationContainer.style.display = 'block';
      }

      // Clear previous result
      document.getElementById('result').classList.remove('visible');
    }

    async function lookupLocation() {
      const input = document.getElementById('location-input').value.trim();
      const feedback = document.getElementById('location-feedback');

      if (!input) {
        feedback.textContent = '';
        feedback.className = 'location-feedback';
        resolvedTimezone = null;
        resolvedSunTimes = null;
        return;
      }

      feedback.textContent = t.lookingUp;
      feedback.className = 'location-feedback loading';

      try {
        const res = await fetch(`/api/location?q=${encodeURIComponent(input)}`);
        const data = await res.json();

        if (data.timezone) {
          resolvedTimezone = data.timezone;
          resolvedDisplayName = data.displayName;
          resolvedSunTimes = data.sunTimes || null;
          feedback.textContent = `âœ“ ${data.timezone} (${data.tzGenericName})`;
          feedback.className = 'location-feedback success';
        } else {
          resolvedTimezone = null;
          resolvedSunTimes = null;
          feedback.textContent = t.locationNotFound;
          feedback.className = 'location-feedback error';
        }
      } catch (e) {
        resolvedTimezone = null;
        feedback.textContent = t.lookupFailed;
        feedback.className = 'location-feedback error';
      }
    }

    async function convert() {
      if (!currentDateTime) {
        alert('Please enter a date and time');
        return;
      }

      // Format as ISO string for API (contract differs by direction)
      const timeInput = currentDirection === 'toLocal'
        ? currentDateTime.toISOString()
        : currentDateTime.toISOString().slice(0, 16);

      if (currentDirection === 'toLocal' && !timeInput.endsWith('Z')) {
        alert('UTC input must include a Z suffix.');
        return;
      }

      if (currentDirection === 'toUTC' && /[zZ]$/.test(timeInput)) {
        alert('Local time input must not include a Z suffix.');
        return;
      }

      if (!resolvedTimezone) {
        alert('Please enter a valid location');
        return;
      }

      try {
        const payload = {
          time: timeInput,
          timezone: resolvedTimezone,
          direction: currentDirection
        };
        if (currentDirection === 'toUTC') {
          payload.disambiguation = document.getElementById('disambiguation-select').value;
        }
        const res = await fetch('/api/convert', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const data = await res.json();

        if (data.error) {
          alert(data.error);
          return;
        }

        // Populate results
        document.getElementById('result-location').textContent = shortenDisplayName(resolvedDisplayName);

        let tzDisplay = `${data.timezone} (${data.tzAbbreviation})`;
        if (data.isDST) {
          tzDisplay += '<span class="dst-indicator active">DST</span>';
        } else if (resolvedTimezone === 'America/Phoenix') {
          tzDisplay += '<span class="dst-indicator inactive">No DST</span>';
        }
        document.getElementById('result-timezone').innerHTML = tzDisplay;

        document.getElementById('result-utc').textContent = data.utcFormatted;
        document.getElementById('result-local').textContent = data.localFormatted;

        // Highlight the result based on direction
        const utcEl = document.getElementById('result-utc');
        const localEl = document.getElementById('result-local');

        if (currentDirection === 'toLocal') {
          utcEl.classList.remove('highlight');
          localEl.classList.add('highlight');
        } else {
          localEl.classList.remove('highlight');
          utcEl.classList.add('highlight');
        }

        // Display sun times if available
        displaySunTimes();

        document.getElementById('result').classList.add('visible');
      } catch (e) {
        alert('Conversion failed');
      }
    }

    function displaySunTimes() {
      const sunTimesEl = document.getElementById('sun-times');

      if (!resolvedSunTimes) {
        sunTimesEl.style.display = 'none';
        return;
      }

      // API returns {utc, zulu, local} objects - use local time
      const getLocalTime = (timeObj) => {
        if (!timeObj || !timeObj.local) return 'â€”';
        return timeObj.local;
      };

      document.getElementById('civil-dawn-time').textContent = getLocalTime(resolvedSunTimes.civilDawn);
      document.getElementById('sunrise-time').textContent = getLocalTime(resolvedSunTimes.sunrise);
      document.getElementById('sunset-time').textContent = getLocalTime(resolvedSunTimes.sunset);
      document.getElementById('civil-dusk-time').textContent = getLocalTime(resolvedSunTimes.civilDusk);

      sunTimesEl.style.display = 'block';
    }

    function shortenDisplayName(name) {
      if (!name) return 'â€”';
      // Take first two parts (city, state/country)
      const parts = name.split(', ');
      return parts.slice(0, 2).join(', ');
    }

    function toggleTheme() {
      const html = document.documentElement;
      const current = html.getAttribute('data-theme');
      const next = current === 'light' ? 'dark' : 'light';
      setTheme(next);
      localStorage.setItem('theme', next);
    }

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      document.getElementById('theme-icon').textContent = theme === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
      document.getElementById('theme-label').textContent = theme === 'light' ? t.light : t.dark;
    }

    function debounce(func, wait) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(() => {});
    }

    // Pull to refresh
    let touchStartY = 0;
    let isPulling = false;
    let isRefreshing = false;

    function getScrollTop() {
      return window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    }

    document.addEventListener('touchstart', (e) => {
      if (getScrollTop() <= 0 && !isRefreshing) {
        touchStartY = e.touches[0].clientY;
        isPulling = true;
      }
    }, { passive: true });

    document.addEventListener('touchmove', (e) => {
      if (!isPulling || isRefreshing) return;
      const touchY = e.touches[0].clientY;
      const pullDistance = touchY - touchStartY;
      if (pullDistance > 100 && getScrollTop() <= 0) {
        isPulling = false;
        isRefreshing = true;
        document.body.style.transition = 'opacity 0.2s ease';
        document.body.style.opacity = '0.5';
        setTimeout(() => location.reload(), 200);
      }
    }, { passive: true });

    document.addEventListener('touchend', () => {
      isPulling = false;
    });
  </script>
</body>
</html>
